---
execute: 
  echo: false
  warning: false
title: "Relatorio Parcial 1"
subtitle: "Daniel Barbosa"
author: "Lucas Castanheira - FitoData"
date: '`r format(Sys.time(), "%d %B, %Y")`'
description: "Criando modelos que expliquem os dados"
title-block-banner: true
format:
 html: 
    embed-resources: true
    smooth-scroll: true
    theme: cosmo
    fontcolor: black
    toc: true
    toc-location: left
    toc-title: Summary
    toc-depth: 3
fontsize: 13pt
editor: visual
---

```{r}
#| label: setup
#| include: false

# library
library(tidyverse)
library(readxl)
library(ggthemes)
library(knitr)
library(ggpubr)
library(gt)

dadosA_davis <- read_excel("../dados/Escala Davis/adavis-adapted.xlsx")

df_A_Davis <- dadosA_davis |> 
  mutate(
    # Criar uma coluna com a indentificação do tratamento
    Tratamento = factor(case_when(
      Adjuvante == "NA" & Taxa == "0" ~ "1",
      Adjuvante == "Aureo" & Taxa == "10" ~ "2",
      Adjuvante == "Silwet" & Taxa == "10" ~ "3",
      Adjuvante == "Ochima" & Taxa == "10" ~ "4",
      Adjuvante == "NA" & Taxa == "10" ~ "5",
      Adjuvante == "Aureo" & Taxa == "30" ~ "6",
      Adjuvante == "Silwet" & Taxa == "30" ~ "7",
      Adjuvante == "Ochima" & Taxa == "30" ~ "8",
      Adjuvante == "NA" & Taxa == "30" ~ "9",
      Adjuvante == "Aureo" & Taxa == "120" ~ "10",
      Adjuvante == "Silwet" & Taxa == "120" ~ "11",
      Adjuvante == "Ochima" & Taxa == "120" ~ "12",
      Adjuvante == "NA" & Taxa == "120" ~ "13"
      )),
    # reorganizar os fatores para ordem crescente de 1 a 13
    Tratamento = fct_relevel(
      Tratamento,
      "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13"),
    Bloco = factor(Bloco),
    Sub = factor(Sub))|> 
  # alongar df
  pivot_longer(names_to = "dias",
               values_to = "Severidade",
               cols = "3DAA":"7DAB") |> 
  mutate(dias = factor(dias),
         Adjuvante = factor(Adjuvante)) |> 
  rename(planta = "Sub")
```

# Introdução

Os dados coletados da severidade (Escala Davis) e da contagem de plantas atacaas não seguem uma distribuição normal. Esses dados se enquadram no grupo de "contagem" e, portanto tendem a seguir uma Distribuição de Poisson, em q

# Resultados Químicos

As análises foram realizadas em maio de 2024 pelo Laboratório de Análise de Solo, Tecido Vegetal e Fertilizante, do Departamento de Solos, UFV.

```{r}
#| label: boxplot-todos-parametros-e-profundidades
#| include: false

####################################
## TODAS AS PROFUNDIDADES ##
################################
# pH H2O
ph_h2o_geral <- df_alongado |> 
  filter(parametros == "ph_H20") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "pH em H2O",
       fill = "Talhão")+
  theme(legend.position = "right",
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                                     "15-30" = "15-30 cm",
                                                     "40-50" = "40-50 cm")))
# P
P_geral <- df_alongado |> 
  filter(parametros == "P") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "P (mg/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",      
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))
# K
K_geral <- df_alongado |> 
  filter(parametros == "K") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "K (mg/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))
# Ca
Ca_geral <- df_alongado |> 
  filter(parametros == "Ca") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "Ca (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))

# Mg
Mg_geral <- df_alongado |> 
  filter(parametros == "Mg") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "Mg (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right", 
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm", 
                                      "15-30" = "15-30 cm",  
                                      "40-50" = "40-50 cm")))

# AL_trocavel (Al3+)
AL_trocavel_geral <- df_alongado |> 
  filter(parametros == "AL_trocavel") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "Al3+ (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+  
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",         
                                      "15-30" = "15-30 cm",      
                                      "40-50" = "40-50 cm")))
AL_trocavel_geral

# acidez_potencial (H + Al)
acidez_potencial_geral <- df_alongado |> 
  filter(parametros == "Acidez_potencial") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "H + Al (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",        
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm", 
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))


# SB
SB_geral <- df_alongado |> 
  filter(parametros == "SB") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "SB (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",       
        axis.text.x = element_blank())+  
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",      
                                      "15-30" = "15-30 cm",     
                                      "40-50" = "40-50 cm")))
SB_geral

# t (CTC efetiva)
t_geral <- df_alongado |> 
  filter(parametros == "t") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "t (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",   
                                      "15-30" = "15-30 cm", 
                                      "40-50" = "40-50 cm")))
t_geral

# T (CTC a pH 7,0)
T_geral <- df_alongado |> 
  filter(parametros == "T") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "T (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",      
                                      "15-30" = "15-30 cm",  
                                      "40-50" = "40-50 cm")))
T_geral

# V (Índice de Saturacão por Bases)
V_geral <- df_alongado |> 
  filter(parametros == "V") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "V (%)",
       fill = "Talhão")+
  theme(legend.position = "right",    
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,               
             labeller = as_labeller(c("0-15" = "0-15 cm",       
                                      "15-30" = "15-30 cm",    
                                      "40-50" = "40-50 cm")))
V_geral

# m (Índice de Saturação por Aluminio)
m_geral <- df_alongado |> 
  filter(parametros == "m") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "m (%)",
       fill = "Talhão")+
  theme(legend.position = "right",      
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",    
                                      "15-30" = "15-30 cm", 
                                      "40-50" = "40-50 cm")))
m_geral

# MO (Matéria Orgânica)
MO_geral <- df_alongado |> 
  filter(parametros == "MO") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "MO (dag/kg)",
       fill = "Talhão")+
  theme(legend.position = "right", 
        axis.text.x = element_blank())+   
  facet_wrap(~Profundidade,            
             labeller = as_labeller(c("0-15" = "0-15 cm", 
                                      "15-30" = "15-30 cm",  
                                      "40-50" = "40-50 cm")))
MO_geral

# p_rem
p_rem_geral <- df_alongado |> 
  filter(parametros == "p_rem") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "p_rem (mg/L)",
       fill = "Talhão")+
  theme(legend.position = "right",  
        axis.text.x = element_blank())+   
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",   
                                      "15-30" = "15-30 cm", 
                                      "40-50" = "40-50 cm")))
p_rem_geral
```

```{r}
#| label: juntando-os-graficos

## df_alongado: Arrange the plots on one page 
ph_h2o_geral
P_geral
K_geral
Ca_geral
Mg_geral
AL_trocavel_geral
acidez_potencial_geral
SB_geral
t_geral
T_geral
V_geral
m_geral
MO_geral
p_rem_geral
```

# Estatística

## Descritiva

```{r}
#| label: descritiva-medias
#| include: false

# apenas as médias
medias_descritiva <- df_alongado |> 
  group_by(talhao, Profundidade, parametros) |> 
  summarise(
    media = mean(resultados)) |> 
  pivot_wider(names_from = parametros,
              values_from = media) |>
  # arrange the table by the Profundidade collumn
  arrange(Profundidade)
```

```{r}
#| label: tabela-descritiva-medias
#| fig-cap: "Tabela 1: valores médios dos parâmetros químicos."

as.data.frame(medias_descritiva) |>
  gt()
```
