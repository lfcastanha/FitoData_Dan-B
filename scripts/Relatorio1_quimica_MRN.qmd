---
execute: 
  echo: false
  warning: false
title: "Relatorio 1 - Etnoflorestas MRN"
subtitle: "Análises Químicas"
author: "Lucas Castanheira"
date: '`r format(Sys.time(), "%d %B, %Y")`'
description: "Análise Estatística e Gráficos"
title-block-banner: true
format:
 html: 
    embed-resources: true
    smooth-scroll: true
    theme: cosmo
    fontcolor: black
    toc: true
    toc-location: left
    toc-title: Summary
    toc-depth: 3
fontsize: 13pt
editor: visual
---

```{r}
#| label: setup
#| include: false

# library
library(tidyverse)
library(readxl)
library(ggthemes)
library(knitr)
library(downloadthis)
library(ggpubr)
library(gt)

##############
## QUIMICA ##
##############
# loading data
analises_quimicas_MRN_completo <- read_excel("../dados/quimica/analises_quimicas_MRN_completo.xlsx")

# Lengthening the data
df_alongado <- analises_quimicas_MRN_completo |> 
  # reordenar os fatores da coluna "talhao", para enfatizar o controle "Almeidas"
  mutate(talhao = fct_relevel(talhao, "Mata_Preservada", "1984", "1992", "1997", "2007", "2020")) |> 
  pivot_longer(cols = c("ph_H20":"p_rem"),
               names_to = "parametros",
               values_to = "resultados")

```

# Introdução

Este é o primeiro relatório das análises química de rotina das amostras de solo coletadas em fevereiro e maio de 2024 na Mineração Rio do Norte (MRN), Porto Trombetas, Pará.

As coletas foram feitas em seis talhões distintos, sendo cinco áreas reflorestadas e uma área de mata preservada:

-   Mata Preservada

-   1984

-   1992

-   1997

-   2007

-   2020

O nome dos talhões indica o ano em que a área foi reflorestada e se é mata preservada.

Em cada talhão, foram escolhidos cinco pontos representativos da área (repetições) para as amostragem A1, A2, A3, A4, A5). Em cada um, coletou-se solo em três profundidades:

-   0-15cm

-   15-30cm

-   30-40cm

# Resultados Químicos

As análises foram realizadas em maio de 2024 pelo Laboratório de Análise de Solo, Tecido Vegetal e Fertilizante, do Departamento de Solos, UFV.

```{r}
#| label: boxplot-todos-parametros-e-profundidades
#| include: false

####################################
## TODAS AS PROFUNDIDADES ##
################################
# pH H2O
ph_h2o_geral <- df_alongado |> 
  filter(parametros == "ph_H20") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "pH em H2O",
       fill = "Talhão")+
  theme(legend.position = "right",
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                                     "15-30" = "15-30 cm",
                                                     "40-50" = "40-50 cm")))
# P
P_geral <- df_alongado |> 
  filter(parametros == "P") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "P (mg/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",      
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))
# K
K_geral <- df_alongado |> 
  filter(parametros == "K") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "K (mg/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))
# Ca
Ca_geral <- df_alongado |> 
  filter(parametros == "Ca") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "Ca (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",
        axis.text.x = element_blank())+
  facet_wrap(~Profundidade, 
             labeller = as_labeller(c("0-15" = "0-15 cm",
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))

# Mg
Mg_geral <- df_alongado |> 
  filter(parametros == "Mg") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "Mg (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right", 
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm", 
                                      "15-30" = "15-30 cm",  
                                      "40-50" = "40-50 cm")))

# AL_trocavel (Al3+)
AL_trocavel_geral <- df_alongado |> 
  filter(parametros == "AL_trocavel") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "Al3+ (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+  
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",         
                                      "15-30" = "15-30 cm",      
                                      "40-50" = "40-50 cm")))
AL_trocavel_geral

# acidez_potencial (H + Al)
acidez_potencial_geral <- df_alongado |> 
  filter(parametros == "Acidez_potencial") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "H + Al (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",        
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm", 
                                      "15-30" = "15-30 cm",
                                      "40-50" = "40-50 cm")))


# SB
SB_geral <- df_alongado |> 
  filter(parametros == "SB") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "SB (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",       
        axis.text.x = element_blank())+  
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",      
                                      "15-30" = "15-30 cm",     
                                      "40-50" = "40-50 cm")))
SB_geral

# t (CTC efetiva)
t_geral <- df_alongado |> 
  filter(parametros == "t") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "t (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",   
                                      "15-30" = "15-30 cm", 
                                      "40-50" = "40-50 cm")))
t_geral

# T (CTC a pH 7,0)
T_geral <- df_alongado |> 
  filter(parametros == "T") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "T (cmolc/dm³)",
       fill = "Talhão")+
  theme(legend.position = "right",     
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",      
                                      "15-30" = "15-30 cm",  
                                      "40-50" = "40-50 cm")))
T_geral

# V (Índice de Saturacão por Bases)
V_geral <- df_alongado |> 
  filter(parametros == "V") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "V (%)",
       fill = "Talhão")+
  theme(legend.position = "right",    
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,               
             labeller = as_labeller(c("0-15" = "0-15 cm",       
                                      "15-30" = "15-30 cm",    
                                      "40-50" = "40-50 cm")))
V_geral

# m (Índice de Saturação por Aluminio)
m_geral <- df_alongado |> 
  filter(parametros == "m") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "m (%)",
       fill = "Talhão")+
  theme(legend.position = "right",      
        axis.text.x = element_blank())+ 
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",    
                                      "15-30" = "15-30 cm", 
                                      "40-50" = "40-50 cm")))
m_geral

# MO (Matéria Orgânica)
MO_geral <- df_alongado |> 
  filter(parametros == "MO") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "MO (dag/kg)",
       fill = "Talhão")+
  theme(legend.position = "right", 
        axis.text.x = element_blank())+   
  facet_wrap(~Profundidade,            
             labeller = as_labeller(c("0-15" = "0-15 cm", 
                                      "15-30" = "15-30 cm",  
                                      "40-50" = "40-50 cm")))
MO_geral

# p_rem
p_rem_geral <- df_alongado |> 
  filter(parametros == "p_rem") |> 
  ggplot(aes(x = talhao, y = resultados, fill = talhao))+
  geom_boxplot()+
  labs(x = "Talhão",
       y = "p_rem (mg/L)",
       fill = "Talhão")+
  theme(legend.position = "right",  
        axis.text.x = element_blank())+   
  facet_wrap(~Profundidade,              
             labeller = as_labeller(c("0-15" = "0-15 cm",   
                                      "15-30" = "15-30 cm", 
                                      "40-50" = "40-50 cm")))
p_rem_geral
```

```{r}
#| label: juntando-os-graficos

## df_alongado: Arrange the plots on one page 
ph_h2o_geral
P_geral
K_geral
Ca_geral
Mg_geral
AL_trocavel_geral
acidez_potencial_geral
SB_geral
t_geral
T_geral
V_geral
m_geral
MO_geral
p_rem_geral
```

# Estatística

## Descritiva

```{r}
#| label: descritiva-medias
#| include: false

# apenas as médias
medias_descritiva <- df_alongado |> 
  group_by(talhao, Profundidade, parametros) |> 
  summarise(
    media = mean(resultados)) |> 
  pivot_wider(names_from = parametros,
              values_from = media) |>
  # arrange the table by the Profundidade collumn
  arrange(Profundidade)
```

```{r}
#| label: tabela-descritiva-medias
#| fig-cap: "Tabela 1: valores médios dos parâmetros químicos."

as.data.frame(medias_descritiva) |>
  gt()
```
